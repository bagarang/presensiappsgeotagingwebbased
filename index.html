<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GEOPRESEN - Work Hard</title>
    <style>
        /* --- TEMA KERJA KERAS (HARD WORK THEME) --- */
        :root {
            --primary-dark: #1a252f;
            --primary-light: #2c3e50;
            --accent: #e67e22;
            --accent-hover: #d35400;
            --bg-app: #ecf0f1;
            --text-main: #2c3e50;
            --white: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: #34495e;
            height: 100dvh; /* Solusi overlap toolbar browser */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #app {
            width: 100%;
            max-width: 480px;
            height: 100%;
            background: var(--bg-app);
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            overflow: hidden;
            display: flex; /* Memastikan isi mengikuti frame */
        }

        .view {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            position: absolute;
            top: 0;
            left: 0;
            background: var(--bg-app);
            z-index: 10;
            overflow-y: auto; /* Mencegah konten tertumpuk jika layar pendek */
        }
        .view.active { display: flex; z-index: 20; }

        /* Fix Mirroring untuk Kamera Depan */
        .mirror { transform: scaleX(-1); }

        h1, h2, h3 { font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; }
        button { border: none; cursor: pointer; font-weight: bold; transition: all 0.2s; }

        /* LOGIN PAGE */
        #view-login {
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(26, 37, 47, 0.85), rgba(26, 37, 47, 0.95)), 
                        url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?auto=format&fit=crop&q=80&w=1000');
            background-size: cover;
            padding: 2rem;
        }
        .login-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2.5rem 2rem;
            border-radius: 4px;
            width: 100%;
            border-top: 4px solid var(--accent);
            text-align: center;
        }
        .logo-text { font-size: 2.8rem; color: var(--white); margin-bottom: 0.5rem; }
        .tagline { font-size: 0.9rem; color: var(--accent); margin-bottom: 2rem; letter-spacing: 2px; font-weight: bold; }
        input { width: 100%; padding: 15px; margin-bottom: 1rem; border-radius: 4px; font-size: 1rem; }
        .btn-login { width: 100%; padding: 15px; background: var(--accent); color: var(--white); text-transform: uppercase; }

        /* HOME PAGE */
        #view-home { justify-content: center; align-items: center; padding: 1.5rem; }
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 1.2rem; width: 100%; }
        .btn-menu {
            padding: 1.5rem; background: var(--white); color: var(--primary-dark);
            border-radius: 8px; border-left: 6px solid var(--accent);
            display: flex; align-items: center; justify-content: space-between;
        }

        /* CAMERA PAGE */
        #view-camera { background: black; overflow: hidden; }
        #camera-video, #photo-result { width: 100%; height: 100%; object-fit: cover; position: absolute; }
        #photo-result { z-index: 2; display: none; }
        
        .camera-ui {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 20px; z-index: 10;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            display: flex; flex-direction: column; align-items: center; gap: 15px;
        }

        /* Flexbox Sempurna untuk Tombol Kamera */
        .controls-row {
            display: flex;
            width: 100%;
            align-items: center;
            justify-content: space-around; /* Menjaga jarak antar elemen tetap simetris */
        }

        .shutter-hard {
            width: 75px; height: 75px; border-radius: 50%;
            border: 4px solid var(--white); background: transparent; position: relative;
        }
        .shutter-hard::after {
            content: ''; position: absolute; top: 8px; left: 8px; right: 8px; bottom: 8px;
            background: var(--white); border-radius: 50%;
        }

        .btn-cam-switch {
            background: rgba(255,255,255,0.2); color: white;
            width: 45px; height: 45px; border-radius: 50%; font-size: 1.2rem;
        }

        .info-card { background: rgba(255,255,255,0.95); width: 100%; padding: 15px; border-radius: 4px; border-left: 4px solid var(--accent); }
        .action-row { display: none; gap: 10px; width: 100%; }
        .btn-action { flex: 1; padding: 12px; color: white; border-radius: 4px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="app">
    <section id="view-login" class="view active">
        <div class="login-box">
            <h1 class="logo-text">GEOPRESEN</h1>
            <div class="tagline">DEDIKASI TANPA BATAS</div>
            <input type="text" id="username" placeholder="USERNAME">
            <input type="password" id="password" placeholder="PASSWORD">
            <button class="btn-login" onclick="handleLogin()">MASUK KERJA</button>
        </div>
    </section>

    <section id="view-home" class="view">
        <div style="text-align: center; margin-bottom: 2rem;">
            <h2>SELAMAT DATANG</h2>
            <p>"Kerja Keras Adalah Kunci Kesuksesan"</p>
        </div>
        <div class="menu-grid">
            <button class="btn-menu" onclick="navTo('view-camera')"><span>üì∑ AMBIL ABSEN</span> <span>‚ùØ</span></button>
            <button class="btn-menu" onclick="handleLogout()" style="background:#e74c3c; color:white; border-left-color:#c0392b;"><span>üö™ LOGOUT</span></button>
        </div>
    </section>

    <section id="view-camera" class="view">
        <video id="camera-video" autoplay playsinline muted></video>
        <canvas id="canvas" class="hidden"></canvas>
        <img id="photo-result">

        <div class="camera-ui">
            <div class="info-card" id="info-panel" style="display:none;">
                <p id="info-time" style="font-weight:bold;"></p>
                <p id="info-loc" style="color:var(--accent); font-size:0.8rem;"></p>
            </div>

            <div class="controls-row" id="shutter-area">
                <button class="btn-cam-switch" onclick="switchCamera()">üîÑ</button>
                <button class="shutter-hard" onclick="takePhoto()"></button>
                <div style="width: 45px;"></div> </div>

            <div class="action-row" id="action-btns">
                <button class="btn-action" style="background:#7f8c8d" onclick="resetCamera()">ULANGI</button>
                <button class="btn-action" style="background:var(--accent)" onclick="sendData()">KIRIM</button>
            </div>
            <button onclick="stopCamAndBack()" style="background:none; color:white; text-decoration:underline; font-size:0.8rem;">BATAL</button>
        </div>
    </section>
</div>

<script>
    let stream = null;
    let facingMode = "environment"; // Default belakang

    function navTo(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        if(viewId === 'view-camera') startCamera(); else stopCamera();
    }

    async function startCamera() {
        stopCamera();
        const video = document.getElementById('camera-video');
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: facingMode } 
            });
            video.srcObject = stream;
            // Mirroring jika pakai kamera depan
            if(facingMode === "user") video.classList.add('mirror');
            else video.classList.remove('mirror');
        } catch (err) {
            alert("Gagal akses kamera!");
            navTo('view-home');
        }
    }

    function switchCamera() {
        facingMode = (facingMode === "environment") ? "user" : "environment";
        startCamera();
    }

    function takePhoto() {
        const video = document.getElementById('camera-video');
        const canvas = document.getElementById('canvas');
        const result = document.getElementById('photo-result');
        
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        
        // Handle mirror saat jepret
        if(facingMode === "user") {
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
        }
        ctx.drawImage(video, 0, 0);
        
        result.src = canvas.toDataURL('image/png');
        result.style.display = 'block';
        video.style.display = 'none';
        
        document.getElementById('shutter-area').classList.add('hidden');
        document.getElementById('info-panel').style.display = 'block';
        document.getElementById('action-btns').style.display = 'flex';
        
        getMetadata();
        stopCamera();
    }

    function stopCamera() {
        if(stream) stream.getTracks().forEach(t => t.stop());
    }

    function resetCamera() {
        document.getElementById('photo-result').style.display = 'none';
        document.getElementById('camera-video').style.display = 'block';
        document.getElementById('shutter-area').classList.remove('hidden');
        document.getElementById('info-panel').style.display = 'none';
        document.getElementById('action-btns').style.display = 'none';
        startCamera();
    }

    function stopCamAndBack() { stopCamera(); navTo('view-home'); }

    function handleLogin() { navTo('view-home'); }
    function handleLogout() { navTo('view-login'); }

    function getMetadata() {
        const now = new Date();
        document.getElementById('info-time').innerText = now.toLocaleString('id-ID');
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                document.getElementById('info-loc').innerText = `Lat: ${pos.coords.latitude.toFixed(5)}, Lng: ${pos.coords.longitude.toFixed(5)}`;
            });
        }
    }

    function sendData() { alert("Absen Berhasil!"); resetCamera(); navTo('view-home'); }
</script>
</body>
</html>
